(function(c, n) {
  const l =
    'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
  c.fn.imagesLoaded = function(f) {
    function m() {
      let b = c(i),
        a = c(h);
      d && (h.length ? d.reject(e, b, a) : d.resolve(e));
      c.isFunction(f) && f.call(g, e, b, a);
    }
    function j(b, a) {
      b.src === l ||
        c.inArray(b, k) !== -1 ||
        (k.push(b),
        a ? h.push(b) : i.push(b),
        c.data(b, 'imagesLoaded', { isBroken: a, src: b.src }),
        o && d.notifyWith(c(b), [a, e, c(i), c(h)]),
        e.length === k.length && (setTimeout(m), e.unbind('.imagesLoaded')));
    }
    var g = this,
      d = c.isFunction(c.Deferred) ? c.Deferred() : 0,
      o = c.isFunction(d.notify),
      e = g.find('img').add(g.filter('img')),
      k = [],
      i = [],
      h = [];
    c.isPlainObject(f) &&
      c.each(f, (b, a) => {
        if (b === 'callback') f = a;
        else if (d) d[b](a);
      });
    e.length
      ? e
          .bind('load.imagesLoaded error.imagesLoaded', b => {
            j(b.target, b.type === 'error');
          })
          .each((b, a) => {
            let d = a.src,
              e = c.data(a, 'imagesLoaded');
            if (e && e.src === d) j(a, e.isBroken);
            else if (a.complete && a.naturalWidth !== n)
              j(a, a.naturalWidth === 0 || a.naturalHeight === 0);
            else if (a.readyState || a.complete) (a.src = l), (a.src = d);
          })
      : m();
    return d ? d.promise(g) : g;
  };
})(jQuery);
